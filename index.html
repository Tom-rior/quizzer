<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Maker</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
        .container { max-width: 600px; margin: auto; border: 1px solid #ccc; padding: 20px; border-radius: 10px; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; cursor: pointer; border-radius: 5px; }
        input { margin-bottom: 10px; display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üìù Quiz Maker (No Streamlit)</h2>
        <p>Step 1: Upload your CSV</p>
        <input type="file" id="csv-upload" accept=".csv">
        
        <p>Step 2: Number of questions</p>
        <input type="number" id="num-q" value="5">

        <button id="gen-btn" py-click="generate_quiz">Generate & Download Quiz</button>
        <div id="output"></div>
    </div>

    <section class="pyscript">
        <script type="py" config='{"packages":["pandas", "python-docx"]}'>
            import pandas as pd
            from docx import Document
            from js import document, Uint8Array, File, window
            import io

            async def generate_quiz(event):
                file_list = document.getElementById("csv-upload").files
                if len(file_list) == 0:
                    document.getElementById("output").innerText = "‚ùå Please upload a file first!"
                    return

                # Read File
                file = file_list.item(0)
                array_buffer = await file.arrayBuffer()
                data = array_buffer.to_py()
                df = pd.read_csv(io.BytesIO(data))

                # Process
                num = int(document.getElementById("num-q").value)
                selected = df.sample(n=min(num, len(df))).to_dict('records')

                # Create Word Doc
                doc = Document()
                doc.add_heading('Quiz', 0)
                for i, q in enumerate(selected, 1):
                    p = doc.add_paragraph()
                    p.add_run(f"Q{i}. {q.iloc[0]}").bold = True
                    doc.add_paragraph(f"A. {q.iloc[1]}")
                    doc.add_paragraph(f"B. {q.iloc[2]}")
                    doc.add_paragraph(f"C. {q.iloc[3]}")
                    doc.add_paragraph(f"D. {q.iloc[4]}")

                # Download Trigger
                out_io = io.BytesIO()
                doc.save(out_io)
                content = Uint8Array.new(out_io.getvalue())
                
                # JavaScript download trigger
                blob = window.Blob.new([content], {type: "application/vnd.openxmlformats-officedocument.wordprocessingml.document"})
                url = window.URL.createObjectURL(blob)
                link = document.createElement("a")
                link.href = url
                link.download = "quiz.docx"
                link.click()
                
                document.getElementById("output").innerText = "‚úÖ Done! Check your downloads."
        </script>
    </section>
</body>
</html>
